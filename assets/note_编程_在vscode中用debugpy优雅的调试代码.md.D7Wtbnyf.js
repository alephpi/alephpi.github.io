import{_ as n,c as a,ao as o,o as l}from"./chunks/framework.n-91xA-b.js";const q=JSON.parse('{"title":"在 vscode 中用 debugpy 优雅的调试 python 代码","description":"","frontmatter":{"title":"在 vscode 中用 debugpy 优雅的调试 python 代码","date":"2024-03-23T11:51:14.239Z","length":"508字","time":"2分钟","aside":true,"hash":-1372751084},"headers":[],"relativePath":"note/编程/在vscode中用debugpy优雅的调试代码.md","filePath":"note/编程/在vscode中用debugpy优雅的调试代码.md"}'),p={name:"note/编程/在vscode中用debugpy优雅的调试代码.md"};function e(t,s,c,r,y,u){return l(),a("div",null,s[0]||(s[0]=[o(`<p>以往在 vscode 中调试代码时，总需要把某个<code>.sh</code>文件中的配置照抄到<code>launch.json</code>中调试其中涉及的单个<code>.py</code>文件。即便有 chatgpt 的帮助，仍煞为繁琐。</p><p>譬如</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-I-Oxm" id="tab-iYG7QN6" checked><label data-title="run_example.sh" for="tab-iYG7QN6">run_example.sh</label><input type="radio" name="group-I-Oxm" id="tab-P7AuzkZ"><label data-title="launch.json" for="tab-P7AuzkZ">launch.json</label></div><div class="blocks"><div class="language-sh active"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki solarized-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#586E75;font-style:italic;">      # run feature and x-vectors extraction</span></span>
<span class="line"><span style="color:#268BD2;">      python</span><span style="color:#2AA198;"> VBx/predict.py</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --in-file-list</span><span style="color:#2AA198;"> exp/list.txt</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --in-lab-dir</span><span style="color:#2AA198;"> example/vad</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --in-wav-dir</span><span style="color:#2AA198;"> example/audios/16k</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --out-ark-fn</span><span style="color:#2AA198;"> exp/</span><span style="color:#859900;">\${</span><span style="color:#268BD2;">filename</span><span style="color:#859900;">}</span><span style="color:#2AA198;">.ark</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --out-seg-fn</span><span style="color:#2AA198;"> exp/</span><span style="color:#859900;">\${</span><span style="color:#268BD2;">filename</span><span style="color:#859900;">}</span><span style="color:#2AA198;">.seg</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --weights</span><span style="color:#2AA198;"> VBx/models/ResNet101_16kHz/nnet/final.onnx</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --backend</span><span style="color:#2AA198;"> onnx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#586E75;font-style:italic;">      # run variational bayes on top of x-vectors</span></span>
<span class="line"><span style="color:#268BD2;">      python</span><span style="color:#2AA198;"> VBx/vbhmm.py</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --init</span><span style="color:#2AA198;"> AHC+VB</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --out-rttm-dir</span><span style="color:#2AA198;"> exp</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --xvec-ark-file</span><span style="color:#2AA198;"> exp/</span><span style="color:#859900;">\${</span><span style="color:#268BD2;">filename</span><span style="color:#859900;">}</span><span style="color:#2AA198;">.ark</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --segments-file</span><span style="color:#2AA198;"> exp/</span><span style="color:#859900;">\${</span><span style="color:#268BD2;">filename</span><span style="color:#859900;">}</span><span style="color:#2AA198;">.seg</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --xvec-transform</span><span style="color:#2AA198;"> VBx/models/ResNet101_16kHz/transform.h5</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --plda-file</span><span style="color:#2AA198;"> VBx/models/ResNet101_16kHz/plda</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --threshold</span><span style="color:#CB4B16;"> -0.015</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --lda-dim</span><span style="color:#D33682;"> 128</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --Fa</span><span style="color:#D33682;"> 0.3</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --Fb</span><span style="color:#D33682;"> 17</span><span style="color:#CB4B16;"> \\</span></span>
<span class="line"><span style="color:#CB4B16;">          --loopP</span><span style="color:#D33682;"> 0.99</span></span></code></pre></div><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki solarized-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#839496;">{</span></span>
<span class="line"><span style="color:#859900;">  &quot;version&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;0.2.0&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">  &quot;configurations&quot;</span><span style="color:#839496;">: [</span></span>
<span class="line"><span style="color:#839496;">    {</span></span>
<span class="line"><span style="color:#859900;">      &quot;name&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;Debug onnx predict&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;type&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;debugpy&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;request&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;launch&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;program&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;\${workspaceFolder}/VBx/predict.py&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;args&quot;</span><span style="color:#839496;">: [</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--in-file-list&quot;</span><span style="color:#839496;">, </span><span style="color:#2AA198;">&quot;exp/list.txt&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--in-lab-dir&quot;</span><span style="color:#839496;">, </span><span style="color:#2AA198;">&quot;example/vad&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--in-wav-dir&quot;</span><span style="color:#839496;">, </span><span style="color:#2AA198;">&quot;example/audios/16k&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--out-ark-fn&quot;</span><span style="color:#839496;">, </span><span style="color:#2AA198;">&quot;exp/ES2005a.ark&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--out-seg-fn&quot;</span><span style="color:#839496;">, </span><span style="color:#2AA198;">&quot;exp/ES2005a.seg&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--weights&quot;</span><span style="color:#839496;">, </span><span style="color:#2AA198;">&quot;VBx/models/ResNet101_16kHz/nnet/final.onnx&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--backend&quot;</span><span style="color:#839496;">, </span><span style="color:#2AA198;">&quot;onnx&quot;</span></span>
<span class="line"><span style="color:#839496;">    ],</span></span>
<span class="line"><span style="color:#859900;">      &quot;console&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;integratedTerminal&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;stopOnEntry&quot;</span><span style="color:#839496;">: </span><span style="color:#B58900;">false</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;cwd&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;\${workspaceFolder}&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;env&quot;</span><span style="color:#839496;">: {},</span></span>
<span class="line"><span style="color:#859900;">      &quot;showReturnValue&quot;</span><span style="color:#839496;">: </span><span style="color:#B58900;">true</span></span>
<span class="line"><span style="color:#839496;">    },</span></span>
<span class="line"><span style="color:#839496;">    {</span></span>
<span class="line"><span style="color:#859900;">      &quot;name&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;Debug VBx inference&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;type&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;debugpy&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;request&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;launch&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;program&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;\${workspaceFolder}/VBx/vbhmm.py&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;args&quot;</span><span style="color:#839496;">: [</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--init&quot;</span><span style="color:#839496;">,</span><span style="color:#2AA198;">&quot;AHC+VB&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--out-rttm-dir&quot;</span><span style="color:#839496;">,</span><span style="color:#2AA198;">&quot;exp&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--xvec-ark-file&quot;</span><span style="color:#839496;">,</span><span style="color:#2AA198;">&quot;exp/ES2005a.ark&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--segments-file&quot;</span><span style="color:#839496;">,</span><span style="color:#2AA198;">&quot;exp/ES2005a.seg&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--xvec-transform&quot;</span><span style="color:#839496;">,</span><span style="color:#2AA198;">&quot;VBx/models/ResNet101_16kHz/transform.h5&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--plda-file&quot;</span><span style="color:#839496;">,</span><span style="color:#2AA198;">&quot;VBx/models/ResNet101_16kHz/plda&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--threshold&quot;</span><span style="color:#839496;">,</span><span style="color:#2AA198;">&quot;-0.015&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--lda-dim&quot;</span><span style="color:#839496;">,</span><span style="color:#2AA198;">&quot;128&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--Fa&quot;</span><span style="color:#839496;">,</span><span style="color:#2AA198;">&quot;0.3&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--Fb&quot;</span><span style="color:#839496;">,</span><span style="color:#2AA198;">&quot;17&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#2AA198;">        &quot;--loopP&quot;</span><span style="color:#839496;">,</span><span style="color:#2AA198;">&quot;0.99&quot;</span></span>
<span class="line"><span style="color:#839496;">      ],</span></span>
<span class="line"><span style="color:#859900;">      &quot;console&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;integratedTerminal&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;stopOnEntry&quot;</span><span style="color:#839496;">: </span><span style="color:#B58900;">false</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;cwd&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;\${workspaceFolder}&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">      &quot;env&quot;</span><span style="color:#839496;">: {},</span></span>
<span class="line"><span style="color:#859900;">      &quot;showReturnValue&quot;</span><span style="color:#839496;">: </span><span style="color:#B58900;">true</span></span>
<span class="line"><span style="color:#839496;">    }</span></span>
<span class="line"><span style="color:#839496;">  ]</span></span>
<span class="line"><span style="color:#839496;">}</span></span></code></pre></div></div></div><p>今天得知 <a href="https://www.bilibili.com/video/BV1wt421V718/?spm_id_from=333.788&amp;vd_source=88b8b9d92849e66d46b1e99860f0cb75" target="_blank" rel="noreferrer">一个相当优雅的办法</a>，无须一一配置待传参数。只需要在<code>.py</code>文件前加上一个 debugpy 的监听器，同时在<code>launch.json</code>中加上一个调试器即可，注意监听端口与连接端口须一致。</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-xchUG" id="tab-rfQHuD0" checked><label data-title="predict.py" for="tab-rfQHuD0">predict.py</label><input type="radio" name="group-xchUG" id="tab-OwQ1Hfx"><label data-title="launch.json" for="tab-OwQ1Hfx">launch.json</label></div><div class="blocks"><div class="language-python active"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki solarized-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#859900;">import</span><span style="color:#839496;"> debugpy</span></span>
<span class="line"><span style="color:#859900;">try</span><span style="color:#839496;">:</span></span>
<span class="line"><span style="color:#586E75;font-style:italic;">    # 5678 is the default attach port in the VS Code debug configurations. Unless a host and port are specified, host defaults to 127.0.0.1</span></span>
<span class="line"><span style="color:#839496;">    debugpy.listen((</span><span style="color:#2AA198;">&quot;localhost&quot;</span><span style="color:#839496;">, </span><span style="color:#D33682;">9501</span><span style="color:#839496;">))</span></span>
<span class="line"><span style="color:#268BD2;">    print</span><span style="color:#839496;">(</span><span style="color:#2AA198;">&quot;Waiting for debugger attach&quot;</span><span style="color:#839496;">)</span></span>
<span class="line"><span style="color:#839496;">    debugpy.wait_for_client()</span></span>
<span class="line"><span style="color:#859900;">except</span><span style="color:#CB4B16;"> Exception</span><span style="color:#859900;"> as</span><span style="color:#839496;"> e:</span></span>
<span class="line"><span style="color:#859900;">    pass</span></span></code></pre></div><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki solarized-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#839496;">    {</span></span>
<span class="line"><span style="color:#859900;">        &quot;name&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;Debug predict&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">        &quot;type&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;debugpy&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">        &quot;request&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;attach&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">        &quot;connect&quot;</span><span style="color:#839496;">: {</span></span>
<span class="line"><span style="color:#859900;">            &quot;host&quot;</span><span style="color:#839496;">: </span><span style="color:#2AA198;">&quot;localhost&quot;</span><span style="color:#839496;">,</span></span>
<span class="line"><span style="color:#859900;">            &quot;port&quot;</span><span style="color:#839496;">: </span><span style="color:#D33682;">9501</span></span>
<span class="line"><span style="color:#839496;">        }</span></span>
<span class="line"><span style="color:#839496;">    },</span></span></code></pre></div><p>这样，在仍旧运行原来的<code>.sh</code>文件，此时被调用的<code>.py</code>文件就会在端口等待连接调试器，然后点击对应端口的调试器就进入调试了！一切照旧，只是免去了配置冗长调试器的麻烦。</p></div></div>`,5)]))}const d=n(p,[["render",e]]);export{q as __pageData,d as default};
